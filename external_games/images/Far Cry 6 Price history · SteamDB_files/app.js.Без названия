"use strict";(function(){"use strict";const C=window.SteamDB,Y=navigator.webdriver||/bot|spider/i.test(navigator.userAgent),G=!!document.querySelector(".header-user-avatar"),Z=document.querySelector(".scope-app"),D=parseInt(Z.dataset.appid,10),te=Z.dataset.chartsType,de=Z.dataset.defaultTab;let K=!1;const z=function(){const e=document.querySelector('relative-time[itemprop="datePublished"]');if(!e)return null;let n=new Date(e.dateTime).getTime();return n+=6e4-n%6e4,n>Date.now()?null:n}(),X=function(){const e=document.querySelector(".js-ea-release-date");return e?new Date(e.dateTime).getTime():null}();C.OnExtensionUserdataLoaded(()=>{let e=C.OwnedApps.has(D);if(!e&&document.querySelector("#subs .package.owned")&&(e=!0),e){const t=document.getElementById("js-app-install");t.classList.add("owned"),t.querySelector("span").textContent="Owned"}else if(C.FamilySharedApps.has(D)){const t=document.getElementById("js-app-install");t.classList.add("infamily"),t.querySelector("span").textContent="In Family"}const n=document.querySelectorAll("#depots tr.depot");for(const t of n){if(C.OwnedApps.has(+t.dataset.depotid)){t.classList.add("owned");continue}const l=t.dataset.packages;if(!l.length)continue;const y=l.split(",");for(const s of y)if(C.OwnedPackages.has(+s)){t.classList.add("owned");break}}}),document.querySelectorAll(".app-logo").forEach(C.ImageError);const ne=document.querySelector(".js-open-screenshot-viewer");ne&&C.RequirePageScreenshotViewer(e=>{const n=[],t=document.querySelector('h1[itemprop="name"]').textContent;let l=null;document.querySelectorAll("#screenshots a").forEach((o,g)=>{n.push(o.dataset.s),o.addEventListener("click",v=>{v.preventDefault(),l(g)})}),l=e(D,t,ne,n).open});async function V(e,n){const t=new URLSearchParams;if(t.append("section",e),t.append("appid",D.toString()),n)for(const s of n)t.append(s[0],s[1]);const l=await fetch(`/api/RenderAppSection/?${t}`,{headers:{Accept:"text/html","X-Requested-With":"XMLHttpRequest"}});if(!l.ok){const s=new Error(`HTTP ${l.status}`);throw s.name="ServerError",s}return await l.text()}const ue=function(){const e=function(){const s=document.body.dataset.steamCdn,o=this.getAttribute("data-name");o&&this.setAttribute("src",s+"steamcommunity/public/images/apps/"+D+"/"+o)};let n=null;if(G){const s=new URLSearchParams;s.append("appid",D.toString()),n=fetch(`/api/GetLoggedInAppStats/?${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})}const t=function(s,o,g){const v=s.querySelector(g).textContent.trim(),h=o.querySelector(g).textContent.trim();return v.localeCompare(h,"en",{numeric:!0})},l=function(s,o,g){const v=o.querySelector(".achievements_list"),h=Array.from(v.querySelectorAll(".achievement"));h.sort((f,c)=>{let r=0;if(s===".achievement_unlock"){const d=parseFloat(f.querySelector(s).textContent),x=parseFloat(c.querySelector(s).textContent);r=g?d-x:x-d}else if(s===".achievement_date"){const d=Number(f.querySelector(s).dataset.sort),x=Number(c.querySelector(s).dataset.sort);r=g?d-x:x-d}else{const d=t(f,c,s);r=g?d:-d}if(r===0&&s!==".achievement_api"){const d=t(f,c,".achievement_api");r=g?-d:d}return r});const p=document.createDocumentFragment();h.forEach(f=>p.appendChild(f)),v.appendChild(p)},y=function(s){const o=s.querySelector(".achievements_sorting"),g=C.Storage.Get("achievements-sort-column"),v=C.Storage.Get("achievements-sort-direction");if(!o)return;const h=function(p,f,c){const r=o.querySelector("button.btn-info");r&&(r.classList.remove("btn-info"),r.classList.add("btn-outline"),r.querySelector(".sort-arrow").remove()),p.classList.remove("btn-outline"),p.classList.add("btn-info");const d=document.createElement("span");d.className="sort-arrow",d.dataset.sort=c?"asc":"desc",d.textContent=c?" \u2191":" \u2193",p.appendChild(d),s.querySelectorAll(".achievements_group").forEach(L=>{l(f,L,c)}),C.Storage.Set("achievements-sort-column",f),C.Storage.Set("achievements-sort-direction",c?"asc":"desc")};o.querySelectorAll("button").forEach(p=>{const f=p.dataset.sort;f===g&&h(p,f,v==="asc"),p.addEventListener("click",function(){let c=!0;if(this.classList.contains("btn-info")){const r=this.querySelector(".sort-arrow");r&&r.dataset.sort==="asc"&&(c=!1)}else(f===".achievement_unlock"||f===".achievement_date")&&(c=!1);h(this,f,c)})})};V("stats").then(s=>{const o=document.querySelector("#stats #js-achievements");o.innerHTML=s,o.querySelectorAll("img").forEach(h=>{C.LazyLoad(h,e)}),o.querySelectorAll(".table-sortable").forEach(h=>{new window.Tablesort(h)}),y(o),C.BindHover&&C.BindHover(o);const g=document.querySelector("#stats #js-stats-api-loading");if(n===null){g.querySelector("#js-stats-api-error").textContent="Sign in to view your achievement progress.";return}n.then(h=>h.json()).then(h=>{if(!h||!h.success){const d=new Error(h.error||"Something went wrong.");throw d.name="ServerError",d}if(h.data.achievements.length===0&&h.data.stats.length===0){g.querySelector("#js-stats-api-error").textContent="You have no achievements.";return}const p=document.querySelector(".achievement_checkmark .octicon-check");let f=0;for(const d of h.data.achievements){if(!d.achieved)continue;const x=document.querySelector(`#stats #achievement-${CSS.escape(`${d.name}`)}`);x?(f++,x.classList.add("achievement_earned"),x.querySelector(".achievement_checkmark").append(p.cloneNode(!0)),x.querySelector(".achievement_spoiler")?.classList.remove("achievement_spoiler"),x.dataset.rare&&x.querySelector(".achievement_image").classList.add("achievement_image_glow")):console.error("Failed to find element for",d.name)}const c=document.querySelector("#stats #js-stats-api"),r=c.querySelector(".achievement_progress_count");if(r){r.textContent=f.toString();const d=+r.dataset.count,x=f/d*100;c.querySelector(".achievement_progress_percent").textContent=`${x.toFixed(f===d?0:1)}%`;const L=c.parentElement.querySelector(".achievement_progressbar_inner");if(L.style.width=`${x}%`,f===d){const a=document.createElement("img");a.className="achievements_icon_completed",a.src="/static/img/achievements_completed.svg",document.querySelector("#stats .achievements_game_logo_contain").append(a)}}for(const d of h.data.stats){const x=document.querySelector(`#stats #stat-${CSS.escape(`${d.name}`)} td:last-child`);x?x.textContent=d.value:console.error("Failed to find element for",d.name)}g.hidden=!0,c.hidden=!1}).catch(h=>{throw g.querySelector("#js-stats-api-error").textContent=`\u26A0 Failed to load your achievements: ${h}`,h});const v=document.querySelector("#js-stats-api .btn");v&&(v.addEventListener("click",function(h){h.preventDefault();const p=document.querySelector("#stats").classList.toggle("achievements_hide_earned");this.classList.toggle("btn-outline",!p),this.classList.toggle("btn-info",p),this.textContent=p?"Show earned":"Hide earned",p?C.Storage.Set("achievements-hide-earned","1"):C.Storage.Remove("achievements-hide-earned")}),C.Storage.Get("achievements-hide-earned")&&v.click())}).catch(s=>{if(document.querySelector("#stats #js-achievements").textContent=`\u26A0 Sorry, failed to load: ${s}`,s.name!=="ServerError")throw s})},he=function(){const e=()=>{const t=document.body.dataset.storeAssets,l=document.getElementById("js-movies");if(l){l.remove();const s=document.querySelector(".screenshots"),o=document.body.dataset.videoCdn,g=JSON.parse(l.dataset.movies);let v=!0;for(const h of g){const p=document.createElement("video");p.preload="metadata",p.controls=!0,p.title=h.name,h.thumb&&(p.poster=`${t}apps/${h.thumb}?t=${h.time}`);for(const[f,c]of Object.entries(h.video)){const r=document.createElement("source");r.type=f,r.src=`${o}store_trailers/${c}?t=${h.time}`,p.append(r)}if(v){v=!1,s.prepend(p);continue}s.append(p)}}document.querySelectorAll("#screenshots a").forEach(s=>{const o=`${t}apps/${D}/${s.dataset.s}`,g=document.createElement("img");g.loading="lazy",g.alt="",g.src=o.replace(".jpg",".600x338.jpg"),s.append(g),s.href=o})},n=document.getElementById("js-view-adult-screenshots");n?n.addEventListener("click",t=>{t.preventDefault(),e(),document.querySelector(".screenshots-adult-warning").hidden=!0,document.querySelector(".screenshots-adult").hidden=!1}):e()},me=function(){const e=function(){this.dataset.src&&(this.src=this.dataset.src)};V("communityitems").then(n=>{const t=document.querySelector("#communityitems #js-communityitems");if(t.innerHTML=n,t.querySelectorAll("img[data-src]").forEach(l=>{C.LazyLoad(l,e)}),C.RequirePageScreenshotViewer(l=>{const y=[],s="Trading cards \u2014 "+document.querySelector('h1[itemprop="name"]').textContent;let o=null;t.querySelectorAll(".view-trading-card").forEach((v,h)=>{y.push(v.href),v.addEventListener("click",p=>{p.preventDefault(),o(h)})}),y.length>0&&(o=l(D,s,null,y).open)}),C.RequirePageScreenshotViewer(l=>{const y=[],s="Profile backgrounds \u2014 "+document.querySelector('h1[itemprop="name"]').textContent;let o=null;t.querySelectorAll(".view-profile-background").forEach((v,h)=>{y.push(v.href),v.addEventListener("click",p=>{p.preventDefault(),o(h)})}),y.length>0&&(o=l(D,s,null,y).open)}),window.location.hash?.startsWith("#")){const l=t.querySelector(window.location.hash);l&&l.scrollIntoView({block:"start"})}}).catch(n=>{if(document.querySelector("#communityitems #js-communityitems").textContent=`\u26A0 Sorry, failed to load: ${n}`,n.name!=="ServerError")throw n})},oe=function(e=null){const n=[];(e===!0||e===null&&new URLSearchParams(location.search).has("all"))&&n.push(["all","true"]),V("patchnotes",n).then(t=>{const l=document.querySelector("#patchnotes #js-patchnotes");l.innerHTML=t;let y=null;const s=(r,d,x)=>{r.preventDefault(),clearTimeout(y),history.replaceState(null,null,d.href),d.remove(),oe(x)};document.querySelector("#js-patchnotes-view-all")?.addEventListener("click",function(r){s(r,this,!0)}),document.querySelector("#js-patchnotes-view-public")?.addEventListener("click",function(r){s(r,this,!1)});const o=document.querySelector("#builds-heatmap"),g=document.getElementById("js-clear-filter"),v=document.getElementById("js-heatmap-label"),h=document.querySelectorAll("#js-builds tr");g.addEventListener("click",function(r){g.hidden=!0,h.forEach(d=>{d.hidden=!1}),r.preventDefault()}),o.querySelectorAll(".cell").forEach(r=>{r.addEventListener("click",function(){if(!(this.parentElement instanceof HTMLTableRowElement))return;const d=this.cellIndex-1,x=this.parentElement.rowIndex-1;h.forEach(L=>{const a=new Date(Number(L.dataset.date)*1e3),b=(a.getUTCDay()+6)%7;L.hidden=a.getUTCHours()!==d||b!==x}),g.hidden=!1}),r.addEventListener("pointerenter",function(){v.textContent=this.getAttribute("aria-label")+". Click to filter."}),r.addEventListener("pointerleave",function(){v.innerHTML="&nbsp;"})}),o.querySelectorAll(".cell-day").forEach(r=>{r.addEventListener("click",function(){if(!(this.parentElement instanceof HTMLTableRowElement))return;const d=this.parentElement.rowIndex-1;h.forEach(x=>{const a=(new Date(Number(x.dataset.date)*1e3).getUTCDay()+6)%7;x.hidden=a!==d}),g.hidden=!1})}),o.querySelectorAll(".cell-hour").forEach(r=>{r.addEventListener("click",function(){const d=this.cellIndex-1;h.forEach(x=>{const L=new Date(Number(x.dataset.date)*1e3);x.hidden=L.getUTCHours()!==d}),g.hidden=!1})}),document.querySelectorAll(".heatmap-year .cell").forEach(r=>{r.addEventListener("click",function(){const d=parseInt(this.dataset.year,10);h.forEach(x=>{const L=new Date(Number(x.dataset.date)*1e3);x.hidden=L.getUTCFullYear()!==d}),g.hidden=!1})});const p=new Intl.DateTimeFormat("en-US",{hour12:!1,hourCycle:"h23",hour:"2-digit",minute:"2-digit",timeZone:"UTC"}),f=document.getElementById("js-current-time");c();function c(){const r=new Date;f.textContent=p.format(r),y=setTimeout(c,(60-r.getSeconds())*1e3+5),o.querySelector(".cell-current-time")?.classList.remove("cell-current-time");const d=r.getUTCHours(),x=(r.getUTCDay()+6)%7;o.rows[x+1].cells[d+1].classList.add("cell-current-time")}}).catch(t=>{if(document.querySelector("#patchnotes #js-patchnotes").textContent=`\u26A0 Sorry, failed to load: ${t}`,t.name!=="ServerError")throw t})},pe=function(){const e=function(){this.dataset.src&&(this.src=this.dataset.src)};V("items").then(n=>{document.querySelector("#items .items-loading").insertAdjacentHTML("afterend",n),document.querySelectorAll("#items img").forEach(t=>{C.LazyLoad(t,e)}),new window.List("items",{valueNames:["economy-item-name","economy-item-description"],page:50,pagination:{outerWindow:2}}),document.querySelector("#items .items-loading").hidden=!0,document.querySelector("#items .list").hidden=!1}).catch(n=>{if(document.querySelector("#items .items-loading").textContent=`\u26A0 Sorry, failed to load: ${n}`,n.name!=="ServerError")throw n})},fe=function(){C.RequireHighstock(function(){const n=C.AppChartFlags||[];if(delete C.AppChartFlags,z!==null){const L=a=>{let b=n.length;for(let $=0;$<n.length;$++)if(n[$].x>a.x){b=$;break}n.splice(b,0,a)};L({x:z,text:"Steam Release",title:"Rel",id:"rel"}),X>0&&z-X>=6048e5&&L({x:X,text:"Early Access Release",title:"EA",id:"ea"})}const t={width:18,height:14,stackDistance:32,color:"rgba(200, 255, 0, 0.2)",shape:"squarepin",borderRadius:6,fillColor:"",style:{fontSize:"11px",color:"rgb(255 255 255 / .9)"},states:{hover:{lineColor:"rgba(200, 255, 0, 1)",fillColor:"#000"}},tooltip:{pointFormat:"<b>{point.text}</b>"}},l=L=>!C.Storage.Get(`app-chart-hide-${L}`),y=L=>{const a=L.legendItem;if(a.options.id){const b=`app-chart-hide-${a.options.id}`;a.visible?C.Storage.Set(b,"1"):C.Storage.Remove(b)}};let s=!1;const o=()=>{if(s)return;s=!0;const L=(S,u)=>{u.data?(u.data.start*=1e3,u.data.start_twitch*=1e3,u.data.step*=1e3,u.data.start_mean=u.data.start):u.data={values:[]},Le(S.data,u.data,n);const w=(I,_)=>{const j=[];let k=S.data[I],U=u.data[I];if(k)for(const F of S.data[_]){if(k>=U)break;j.push([k,F]),k+=S.data.step}if(k=U,I==="start_mean"){const F=xe(u.data.values,24);for(const J of F)j.push([k,J]),k+=u.data.step;return j}if(k)if(I==="start"&&u.data.values_10m){U=u.data.start_10m*1e3,u.data.step_10m*=1e3;for(const F of u.data[_]){if(k>=U)break;j.push([k,F]),k+=u.data.step}k=U;for(const F of u.data.values_10m)j.push([k,F]),k+=u.data.step_10m}else if(I==="start_twitch"&&u.data.values_10m){U=u.data.start_10m*1e3;const F=u.data.step/u.data.step_10m,J=U+u.data.step_10m*(u.data.values_10m.length-1);for(const ce of u.data[_]){if(j.push([k,ce]),k>=U&&k<J)for(let ee=1;ee<F;ee++){const le=k+u.data.step_10m*ee;le<=J&&j.push([le,ce])}k+=u.data.step}}else for(const F of u.data[_])j.push([k,F]),k+=u.data.step;return j},m=w("start","values");let E=null;if(G&&(E=w("start_mean","values_mean"),m.length>0&&E.length>0)){const I=m[m.length-1];I[0]-E[E.length-1][0]>0&&E.push([I[0],E[E.length-1][1]])}const i={click(){window.history.replaceState(null,null,`#${this.text}`)}},q={enabled:!0,approximation:"high",groupPixelWidth:G?10:20,units:[["hour",[1]],["day",[1]],["week",[1]],["month",[1]]]},R=[{type:"day",count:2,text:"48h",dataGrouping:{enabled:!1},events:i},{type:"week",count:1,text:"1w",dataGrouping:{enabled:!1},events:i},{type:"day",count:30,text:"1m",dataGrouping:q,events:i},{type:"month",count:3,text:"3m",dataGrouping:q,events:i},{type:"month",count:6,text:"6m",dataGrouping:q,events:i},{type:"year",count:1,text:"1y",dataGrouping:q,events:i}];if(S.data.start>0){const I=Math.floor((Date.now()-S.data.start)/3154e7)-1;for(let _=3;_<=I;_+=3)R.push({type:"year",count:_,text:`${_}y`,dataGrouping:q,events:i})}const T=structuredClone(q);T.units.shift(),R.push({type:"all",text:"max",preserveDataGrouping:!0,dataGrouping:T,events:i});const B=I=>{const _=I.series[0].currentDataGrouping;if(!_||_.unitName!=="day"){I.series[0].update({zones:[]});return}const j=Math.floor(Date.now()/864e5)*864e5-864e5;I.series[0].update({zones:[{value:j},{color:"#666",dashStyle:"Dash"}]})},H=new Date().toLocaleDateString("en-GB",{day:"2-digit",timeZoneName:"short"}).substring(4),O=new Intl.DateTimeFormat("en-GB",{timeStyle:"short",hourCycle:"h23"}),M={chart:{renderTo:"js-chart-players",events:{load(){B(this)}}},scrollbar:{enabled:!1},legend:{enabled:!0,events:{itemClick:y}},exporting:{filename:`steamdb_chart_${D}`,chartOptions:{title:{text:`SteamDB.info \u2014 ${document.querySelector('h1[itemprop="name"]').textContent} \u2014 Players`}}},rangeSelector:{enabled:!0,inputEnabled:!1,selected:1,buttons:R},yAxis:{allowDecimals:!1,min:0},xAxis:{ordinal:!1,type:"datetime",events:{afterSetExtremes(){B(this.chart)}}},plotOptions:{series:{dataGrouping:q},flags:t},navigator:{series:{type:"areaspline",fillColor:"rgba(65, 77, 25, 0.7)"}},tooltip:{formatter(I){const _=this.points||[this],j=[I.headerFooterFormatter(_[0])];return j[0].includes(":")&&j.push('<div class="highcharts-local-time">'+O.format(_[0].x)+" "+H+"</div>"),j.push(...I.bodyFormatter(_)),j}},series:[{zIndex:4,lineWidth:2,type:"area",color:"var(--charts-players)",fillColor:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"rgba(65, 77, 25, 0.2)"],[1,"rgba(65, 77, 25, 0)"]]},zoneAxis:"x",name:te==="1"?"Players":"Users",id:"players",data:m}]};if(window.location.hash.length>0){const I=window.location.hash.substring(1);for(let _=0;_<M.rangeSelector.buttons.length;_++)if(M.rangeSelector.buttons[_].text===I){M.rangeSelector.selected=_;break}}else{let I=0;for(const _ of m)if(_[1]!==null){I=_[0];break}Date.now()-I<6048e5&&(M.chart.events={load(){const _=this.xAxis[0];_.setExtremes(I,_.max)}})}if(E!==null&&E.length>0&&M.series.push({id:"players_trend",visible:l("players_trend"),zIndex:1,lineWidth:1,color:"#666",type:"line",name:te==="1"?"Average Players":"Average Users",data:E,enableMouseTracking:!1,zoneAxis:"x",zones:[{value:u.data.start},{dashStyle:"Dash"}]}),D===753){const I=w("start_twitch","values_twitch");M.series.push({id:"ingame",zIndex:2,color:"#0288D7",type:"line",name:"In-Game",data:I})}if(n.length>0){const I=S.data.start>0?S.data.start:u.data.start,_=structuredClone(n.filter(j=>j.x>I));_.forEach(j=>{j.x<u.data.start&&(j.x-=j.x%864e5)}),M.series.push({id:"flags",visible:l("flags"),zIndex:10,type:"flags",name:"Markers",onSeries:"players",includeInDataExport:!1,data:_})}new window.Highcharts.StockChart(M)},a=new URLSearchParams;a.append("appid",D.toString());let b,$={};document.querySelector('link[rel="preload"][as="fetch"]')||($={Accept:"application/json","X-Requested-With":"XMLHttpRequest"}),Y||(b=fetch(`/api/${G?"GetGraphWeekLoggedIn":"GetGraphWeek"}/?${a}`,{headers:$})),fetch(`/api/${G?"GetGraphMaxLoggedIn":"GetGraphMax"}/?${a}`,{headers:$}).then(S=>S.ok?S.json():{}).then(S=>{if(!S){const u=new Error(S.error||"Something went wrong.");throw u.name="ServerError",u}return S.data?(S.data.start*=1e3,S.data.start_twitch*=1e3,S.data.start_mean*=1e3,S.data.step*=1e3):S.data={start:0},Y?(L(S,{}),null):b.then(u=>{if(!u.ok&&u.status!==404){const w=new Error(`HTTP ${u.status}`);throw w.name="ServerError",w}return u.json()}).then(u=>{if(!u||!u.success)throw new Error(u.error||"Something went wrong.");L(S,u)}).catch(u=>{L(S,{}),C.Alert(`Failed to load high precision charts: ${u||"Something went wrong."}`),console.error(u)})}).catch(S=>{const u=document.querySelector("#js-chart-players");if(S.message==="No data."){u.textContent="There is no data for this.";return}if(u.textContent=`\u26A0 Sorry, failed to load this chart: ${S}`,S.name!=="ServerError")throw S})},g=()=>{const L=new URLSearchParams;L.append("appid",D.toString()),fetch(`/api/GetGraphFollowers/?${L}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(a=>a.json()).then(a=>{if(!a||!a.data){const A=new Error(a.error||"Something went wrong.");throw A.name="ServerError",A}a.data.start*=1e3,a.data.step*=1e3;const b={chart:{renderTo:"js-chart-followers"},scrollbar:{enabled:!1},legend:{enabled:!0},navigator:{enabled:!1},exporting:{filename:`steamdb_chart_${D}`,chartOptions:{title:{text:`SteamDB.info \u2014 ${document.querySelector('h1[itemprop="name"]').textContent} \u2014 Followers`}}},rangeSelector:{enabled:!0,inputEnabled:!1,buttons:[{type:"week",count:1,text:"1w"},{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"}]},yAxis:{allowDecimals:!1,min:0},xAxis:{type:"datetime"},plotOptions:{series:{dataGrouping:{enabled:!0,approximation:"high",groupPixelWidth:10,units:[["hour",[1]],["day",[1]],["week",[1]],["month",[1]]]}},flags:t},series:[{zIndex:1,color:"#0288D7",type:"line",name:"Followers",id:"followers",pointStart:a.data.start,pointInterval:a.data.step,data:a.data.values}]},$=Math.floor((Date.now()-a.data.start)/3154e7)-1;for(let A=3;A<=$;A+=3)b.rangeSelector.buttons.push({type:"year",count:A,text:`${A}y`});if(b.rangeSelector.buttons.push({type:"all",text:"max"}),n.length>0){const A=structuredClone(n.filter(S=>S.x>a.data.start));A.forEach(S=>{S.x-=S.x%864e5}),b.series.push({zIndex:10,type:"flags",name:"Markers",onSeries:"followers",includeInDataExport:!1,data:A})}new window.Highcharts.StockChart(b)}).catch(a=>{const b=document.querySelector("#js-chart-followers");if(a.message==="No data."){b.textContent="There is no data for this.";return}if(b.textContent=`\u26A0 Sorry, failed to load this chart: ${a}`,a.name!=="ServerError")throw a})},v=()=>{if(!G)return;const L=new URLSearchParams;L.append("appid",D.toString()),fetch(`/api/GetGraphReviewsLoggedIn/?${L}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(a=>a.json()).then(a=>{if(!a||!a.data){const T=new Error(a.error||"Something went wrong.");throw T.name="ServerError",T}let b=0,$=0;a.data.start<1433116800&&(b=a.data.values_p[0],$=a.data.values_n[0]);const A=a.data.values_p,S=[],u=[],w=[],m=[];for(let T=0;T<a.data.values_p.length;T++){const B=a.data.values_p[T],H=a.data.values_n[T];B<=b?u.push(null):u.push(B-b),b=B,S.push(-H),H<=$?w.push(null):w.push(-(H-$)),$=H,m.push(B/(B+H)*100)}const E={enabled:!0,approximation:"sum",groupPixelWidth:10,units:[["hour",[1]],["day",[1]],["week",[1]],["month",[1]]]};a.data.start*=1e3,a.data.step*=1e3;const i={chart:{alignThresholds:!0,renderTo:"js-chart-reviews"},scrollbar:{enabled:!1},legend:{enabled:!0},navigator:{enabled:!1},exporting:{filename:`steamdb_chart_${D}`,chartOptions:{title:{text:`SteamDB.info \u2014 ${document.querySelector('h1[itemprop="name"]').textContent} \u2014 Reviews`}}},rangeSelector:{enabled:!0,inputEnabled:!1,buttons:[{type:"week",count:1,text:"1w"},{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"}]},yAxis:[{minPadding:0,maxPadding:0,allowDecimals:!1,labels:{align:"left"}},{min:0,max:100,allowDecimals:!0,opposite:!1}],xAxis:{type:"datetime"},plotOptions:{series:{dataGrouping:E,threshold:0},column:{stacking:"normal",pointPadding:0},flags:t},series:[{id:"positive",name:"Positive reviews",color:"#0288D7",type:"column",fillColor:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"rgba(2, 119, 189, 0)"],[1,"rgba(2, 119, 189, 0.2)"]]},pointStart:a.data.start,pointInterval:a.data.step,data:u},{id:"negative",name:"Negative reviews",color:"#EF7676",type:"column",fillColor:{linearGradient:{x1:0,x2:0,y1:1,y2:0},stops:[[0,"rgba(239, 118, 118, 0)"],[1,"rgba(239, 118, 118, 0.2)"]]},pointStart:a.data.start,pointInterval:a.data.step,data:w},{visible:!1,yAxis:1,id:"rating",name:"Rating",color:"var(--charts-players)",type:"line",pointStart:a.data.start,pointInterval:a.data.step,data:m,dataGrouping:{approximation:"average"},tooltip:{valueDecimals:1,valueSuffix:"%"}}]},q=Math.floor((Date.now()-a.data.start)/3154e7)-1;for(let T=3;T<=q;T+=3)i.rangeSelector.buttons.push({type:"year",count:T,text:`${T}y`});if(i.rangeSelector.buttons.push({type:"all",text:"max"}),n.length>0){const T=structuredClone(n.filter(B=>B.x>a.data.start));T.forEach(B=>{B.x-=B.x%864e5}),i.series.push({zIndex:10,type:"flags",name:"Markers",includeInDataExport:!1,data:T})}window.Highcharts.Axis.prototype.hasData=function(){return this.hasVisibleSeries};const R=new window.Highcharts.StockChart(i);{const T=H=>{E.approximation=H?"high":"sum";let O=R.get("positive");O.update({dataGrouping:E,type:H?"area":"column"},!1),O.setData(H?A:u,!1),O=R.get("negative"),O.update({dataGrouping:E,type:H?"area":"column"},!1),O.setData(H?S:w,!1),R.redraw()},B=document.querySelector("#js-chart-reviews-cumulative");B.addEventListener("change",()=>T(B.checked)),B.checked&&T(!0)}}).catch(a=>{const b=document.querySelector("#js-chart-reviews");if(a.message==="No data."){b.textContent="There is no data for this.";return}if(b.textContent=`\u26A0 Sorry, failed to load this chart: ${a}`,a.name!=="ServerError")throw a})},h=()=>{const L=new URLSearchParams;L.append("appid",D.toString()),fetch(`/api/GetGraphTwitch/?${L}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(a=>a.json()).then(a=>{if(!a||!a.data){const A=new Error(a.error||"Something went wrong.");throw A.name="ServerError",A}a.data.start*=1e3,a.data.step*=1e3;const b={chart:{renderTo:"js-chart-twitch"},scrollbar:{enabled:!1},legend:{enabled:!0},navigator:{enabled:!1},exporting:{filename:`steamdb_chart_${D}`,chartOptions:{title:{text:`SteamDB.info \u2014 ${document.querySelector('h1[itemprop="name"]').textContent} \u2014 Twitch Viewers`}}},rangeSelector:{enabled:!0,inputEnabled:!1,buttons:[{type:"week",count:1,text:"1w"},{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"}]},yAxis:{allowDecimals:!1,min:0},xAxis:{type:"datetime"},plotOptions:{series:{dataGrouping:{enabled:!0,approximation:"high",groupPixelWidth:10,units:[["hour",[1]],["day",[1]],["week",[1]],["month",[1]]]}},flags:t},series:[{zIndex:1,color:"#0288D7",type:"line",name:"Viewers",id:"viewers",pointStart:a.data.start,pointInterval:a.data.step,data:a.data.values}]},$=Math.floor((Date.now()-a.data.start)/3154e7)-1;for(let A=3;A<=$;A+=3)b.rangeSelector.buttons.push({type:"year",count:A,text:`${A}y`});if(b.rangeSelector.buttons.push({type:"all",text:"max"}),n.length>0){const A=structuredClone(n.filter(S=>S.x>a.data.start));A.forEach(S=>{S.x-=S.x%864e5}),b.series.push({zIndex:10,type:"flags",name:"Markers",onSeries:"viewers",includeInDataExport:!1,data:A})}new window.Highcharts.StockChart(b)}).catch(a=>{const b=document.querySelector("#js-chart-twitch");if(a.message==="No data."){b.textContent="There is no data for this.";return}if(b.textContent=`\u26A0 Sorry, failed to load this chart: ${a}`,a.name!=="ServerError")throw a})},p=document.getElementById("js-chart-players"),f=document.getElementById("js-chart-followers"),c=document.getElementById("js-chart-reviews");p&&C.LazyLoad(p,o),f&&!Y&&C.LazyLoad(f,g),c&&!Y&&C.LazyLoad(c,v);const r=document.getElementById("js-chart-month-loading");r&&(C.LazyLoad(r,o),document.getElementById("js-chart-month-unfold").addEventListener("click",function(L){L.preventDefault(),this.hidden=!0,document.querySelector(".chart-month-container").classList.add("chart-month-unfolded")}));const d=document.getElementById("twitch"),x=document.querySelector("#js-chart-twitch-btn");d&&x&&(x.addEventListener("click",function(L){L.preventDefault(),L.isTrusted&&window.history.replaceState(null,null,this.href),d.removeAttribute("hidden"),this.remove(),h(),setTimeout(()=>d.scrollIntoView({block:"center",behavior:"smooth"}),1)}),window.location.hash==="#twitch"&&x.click())});const e=document.getElementById("js-embed-button");e&&e.addEventListener("click",function(){const n=document.getElementById("js-embed-code"),t=n.querySelector("pre");t.insertAdjacentHTML("afterend",t.textContent),this.hidden=!0,n.hidden=!1;const l=document.createRange();l.selectNodeContents(t);const y=window.getSelection();return y.removeAllRanges(),y.addRange(l),!1})},ge=function(){const e=document.getElementById("js-price-history"),n=document.getElementById("js-chart-prices"),t=document.querySelector("#js-store-iframe");n&&(Y&&(K=!0),C.LazyLoad(n,()=>{K||e.click()})),t&&C.LazyLoad(t,()=>{t.src=t.dataset.src})},ye=function(){const e=document.querySelector("#js-linked-apps"),n=new URLSearchParams;n.append("appid",D.toString()),fetch(`/api/RenderLinkedApps/?${n}`,{headers:{Accept:"text/html","X-Requested-With":"XMLHttpRequest"}}).then(t=>{if(!t.ok){const l=new Error(`HTTP ${t.status}`);throw l.name="ServerError",l}return t.text()}).then(t=>{e.innerHTML=t,C.EnhanceLazyLoadedApps(e),new window.Tablesort(e.querySelector(".table-sortable"))}).catch(t=>{if(t.name==="ServerError"&&t.message==="HTTP 404"){e.textContent="This app is not referenced by any other app that we are aware of.";return}if(e.textContent=`\u26A0 Sorry, failed to load: ${t}`,t.name!=="ServerError")throw t})},ve=function(){const e=document.getElementById("js-assets-load");e&&(e.addEventListener("click",function(){e.remove();const n=document.createElement("div");n.className="community-items-container community-items-assets",n.id="assets";const t=new Set,l=o=>{const g=o.lastIndexOf("?"),v=`/apps/${D}`,h=o.indexOf(`/apps/${D}`),p=o.substring(h+v.length+1,g===-1?o.length:g);if(t.has(p))return;t.add(p);const f=document.createElement("a");f.className="community-item",f.href=o,f.target="_blank";const c=document.createElement("span"),r=p.indexOf("/");r>0?c.textContent=p.substring(r+1):c.textContent=p,f.append(c);const d=document.createElement("img");d.addEventListener("error",function(){f.remove()},{once:!0}),d.addEventListener("load",function(){c.textContent+=` (${d.naturalWidth}x${d.naturalHeight})`},{once:!0}),d.alt="",d.src=o,f.append(d),n.append(f)},y=document.getElementById("js-assets-table");y.querySelectorAll(".image-hover").forEach(o=>l(o.href)),y.insertAdjacentElement("afterend",n)}),window.location.hash==="#assets"&&e.click())},N=function(e,n){if(de===e)n();else{const t=document.getElementById(`tab-${e}`);t&&t.addEventListener("tab-shown",n,{once:!0})}},re=document.getElementById("js-charts-button");re&&re.addEventListener("click",function(e){e.preventDefault(),document.getElementById("tab-charts").click()});const Q=document.querySelector("#js-reviews-button");Q&&Q.addEventListener("click",function(e){e.preventDefault(),document.getElementById("tab-charts").click(),setTimeout(()=>{location.href=Q.href},0)});const ae=document.getElementById("js-currency-selector-btn");ae&&(ae.addEventListener("click",function(e){e.preventDefault(),document.querySelector("#js-currency-selector").classList.toggle("shown")}),document.querySelectorAll("#js-currency-selector .btn").forEach(e=>{e.addEventListener("click",function(n){n.preventDefault();const t=this.dataset.cc;document.cookie="__Host-cc="+t+"; path=/; secure; samesite=lax; max-age=7776000",window.location.replace(window.location.pathname)})}));const se=document.getElementById("js-currency-comparer");se&&se.addEventListener("click",function(e){e.preventDefault(),this.closest(".single-price-mobile").remove()}),document.querySelectorAll(".price-line").forEach(e=>{e.addEventListener("click",function(n){n.preventDefault(),K=!0;const t=this.dataset.cc;document.getElementById("js-chart-prices").innerHTML='<span class="loader"></span><p>Loading price history\u2026</p>',document.getElementById("pricehistory").textContent=`Price history (${t.toUpperCase()})`,C.RequireHighstock(function(){const l=new URLSearchParams;l.append("appid",D.toString()),l.append("cc",t);let y=!1;fetch(`/api/${G?"GetPriceHistoryLoggedIn":"GetPriceHistory"}/?${l}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(s=>{if(y=s.headers.has("X-SteamDB-History-More"),y){const o=document.getElementById("js-prices-truncated");o&&(o.hidden=!1)}return s.json()}).then(s=>{if(!s||!s.success){const c=new Error(s.error||"Something went wrong.");throw c.name="ServerError",c}const o=s.data,g=[];let v=Number.MAX_SAFE_INTEGER,h=null;if(o.history.length>0){let c=Date.now();(t==="old-try"||t==="old-ars")&&(c=17005032e5);let r={...o.history[o.history.length-1]};r.x=c,o.history.push(r);for(r of o.history)!r.y&&!r.d||(v>r.y&&(v=r.y,h=r.f),g.push({x:r.x,y:v,f:h,d:0}));g.length>0&&o.history[o.history.length-1].y>0&&(r={...g[g.length-1]},r.x=c,g.push(r))}const p=G?"Historical Low":"2-year low",f={chart:{renderTo:"js-chart-prices"},scrollbar:{enabled:!1},legend:{enabled:!0},navigator:{enabled:!1},exporting:{filename:`steamdb_chart_${D}`,chartOptions:{title:{text:`SteamDB.info \u2014 ${document.querySelector('h1[itemprop="name"]').textContent} \u2014 Price History (${t.toUpperCase()})`}}},rangeSelector:{enabled:!0,inputEnabled:!1,selected:2,buttons:[{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"}]},tooltip:{xDateFormat:"%A, %b %e, %Y"},yAxis:{gridLineWidth:0,minorGridLineWidth:0,min:0},xAxis:{ordinal:!1,type:"datetime"},series:[{id:"price",step:"left",color:"var(--charts-players)",type:"line",name:"Final price",data:o.history,lineWidth:2,tooltip:{pointFormatter(){let c="";const r=this;return r.d>0?(c+='Price: <b style="color:var(--tooltip-green)">'+r.f+"</b>",c+="<br/>Discount: <b>-"+r.d+"%</b>"):r.y?c+="Price: <b>"+r.f+"</b><br/>No discount":c+="No Price",o.sales[this.x]&&(c+=`<br/><b style="color:var(--tooltip-green)">\u25B2 ${o.sales[this.x]}</b><br/>`),c}}},{step:"left",type:"area",dashStyle:"Dash",lineWidth:1,color:"#0288D7",fillColor:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"rgba(2, 119, 189, 0)"],[1,"rgba(2, 119, 189, 0.2)"]]},name:p,data:g,tooltip:{pointFormatter(){let c="";const r=this;return r.y&&(c+=`<br/><i>${p}: ${r.f}</i>`),c}}}]};if(o.history.length>0)if(G){const c=Math.floor((Date.now()-o.history[0].x)/3154e7)-1;for(let r=3;r<=c;r+=3)f.rangeSelector.buttons.push({type:"year",count:r,text:`${r}y`});f.rangeSelector.buttons.push({type:"all",text:"max"})}else f.rangeSelector.buttons.push({type:"all",text:y?"2y":"max"});if(z!==null&&o.history.length>0&&z+864e5>o.history[0].x){let c={x:z,text:"Steam Release",title:"Rel",id:"rel"};o.history.length>0&&Math.abs(c.x-o.history[0].x)<864e5&&(c.x=o.history[0].x);const r=[c];X>0&&z-X>=6048e5&&(c={x:X,text:"Early Access Release",title:"EA",id:"ea"},o.history.length>0&&Math.abs(c.x-o.history[0].x)<864e5&&(c.x=o.history[0].x),r.unshift(c)),f.series.push({zIndex:10,type:"flags",name:"Markers",onSeries:"price",includeInDataExport:!1,width:16,height:16,data:r,shape:"squarepin",borderRadius:6,y:-60,color:"rgba(150, 150, 150, 0.2)",fillColor:"",style:{fontSize:"12px",color:"#fff"},states:{hover:{fillColor:"#000"}}})}new window.Highcharts.StockChart(f)}).catch(s=>{const o=document.querySelector("#js-chart-prices");if(s.message==="No data."){o.textContent="There is no price history for this.";return}if(o.textContent=`\u26A0 Sorry, failed to load price history: ${s}`,s.name!=="ServerError")throw s})}),n.isTrusted&&document.querySelector("#js-chart-prices").scrollIntoView({behavior:"smooth",block:"nearest"})})}),document.querySelectorAll(".table-sortable").forEach(e=>{new window.Tablesort(e)}),N("prices",ge),N("stats",ue),N("items",pe),N("charts",fe),N("screenshots",he),N("communityitems",me),N("linked",ye),N("info",ve),N("patchnotes",oe),ie(document.querySelectorAll(".image-hover")),C.BindImageHover=ie;function ie(e){for(let n=0;n<e.length;n++)e[n].addEventListener("pointerenter",Se,{passive:!0}),e[n].addEventListener("pointerleave",we,{passive:!0})}let P=null;function Se(e){const n=e.target;n instanceof Element&&(P&&P.remove(),P=document.createElement("img"),P.className="hover-image",P.referrerPolicy="no-referrer",P.src=this.dataset.src||this.href,P.addEventListener("load",()=>{if(!P)return;const t=document.getElementById("js-hover");if(!t)return;t.appendChild(P),t.hidden=!1;const l=n.getBoundingClientRect();t.style.top=l.bottom+window.scrollY+"px",t.style.left=l.x+"px"}))}function we(){if(!P)return;const e=document.getElementById("js-hover");e&&(e.hidden=!0,e.style.top=null,e.style.left=null,P.onload=null,P.src="",P.remove(),P=null)}function xe(e,n){const t=Ee(e,n),l=be(e,n),y=[];for(let s=0;s<e.length;s++){const o=(e.length-s)/e.length;y[s]=Math.round(o*t[s]+(1-o)*l[s])}return y}function be(e,n){const t=[e[0]],l=[e[0]];for(let y=1;y<e.length;y++)l.push(e[y]),t[y]=W(l),l.length>=n&&l.shift();return t}function Ee(e,n){const t=[],l=e.slice(0,n);for(let y=0;y<e.length;y++)t[y]=W(l),l.shift(),y<e.length-n&&l.push(e[y+n]);return t}function W(e){const n=1/e.length;let t=0;for(const l of e)t+=n*l;return t}function Le(e,n,t){const l=document.querySelector("#chart-month-table");if(!l)return;const y=document.getElementById("js-chart-month-loading");if(!e.start){y.textContent="No data yet.";return}const s=["January","February","March","April","May","June","July","August","September","October","November","December"],o=new Map,g=e.step;let v=e.start,h=0,p=0,f=0,c=0,r=0;const d=()=>{f=0,r<t.length?(p=t[r].x,p-=p%864e5):p=Number.MAX_SAFE_INTEGER,r++,r<t.length?(c=t[r].x,c-=c%864e5):c=Number.MAX_SAFE_INTEGER},x=()=>{if(f===0)return;const w=t[r-1].id,m=document.getElementById(`js-marker-${w}`);m&&(m.textContent=f.toLocaleString("en-US"),m.dataset.sort=f.toString())},L=w=>{const m=new Date(w),E=m.getFullYear(),i=m.getMonth();return[(E-1970)*12+i,E,i]};d();for(const w of e.values){if(w!==null){const[m,E,i]=L(v);o.has(m)?o.get(m).values.push(w):o.set(m,{name:`${s[i]} ${E}`,text:"",values:[w],values_mean:[],values_twitch:[],max:0,max_twitch:0,avg:0}),h=m}v>=c&&(x(),d()),v>=p&&v<=p+2592e6&&f<w&&(f=w),v+=g}if(x(),!o.size){y.textContent="No data yet.";return}if(e.values_mean){v=e.start_mean;for(const w of e.values_mean){if(w!==null){const m=new Date(v),E=m.getFullYear(),i=m.getMonth(),q=(E-1970)*12+i;o.has(q)&&o.get(q).values_mean.push(w)}v+=g}}if(e.values_twitch){v=e.start_twitch;for(const w of e.values_twitch){if(w!==null){const m=new Date(v),E=m.getFullYear(),i=m.getMonth(),q=(E-1970)*12+i;o.has(q)&&o.get(q).values_twitch.push(w)}v+=g}}o.has(632)&&(o.get(632).values_mean=[]);const a=-30,b=o.get(h);b.name="Last 30 days",b.values=e.values.slice(a),n.values&&b.values.push(...n.values.slice(-48)),e.values_twitch&&(b.values_twitch=e.values_twitch.slice(a),n.values_twitch&&b.values_twitch.push(...n.values_twitch.slice(-48))),e.values_mean&&(b.values_mean=e.values_mean.slice(a).filter(w=>w!==null));const $=document.createDocumentFragment();let A=0,S=0;for(const w of t){const m=L(w.x)[0],E=o.get(m);E&&(E.text?E.text+=`, ${w.text}`:E.text=w.text)}for(const[,w]of o){for(const m of w.values)w.max<m&&(w.max=m);for(const m of w.values_twitch)w.max_twitch<m&&(w.max_twitch=m);w.avg=Math.round(W(w.values_mean))}const u=document.querySelector(".octicon-info");for(const[w,m]of o){const E=document.createElement("tr");$.appendChild(E);let i=document.createElement("td");if(i.dataset.sort=w.toString(),m.text){const q=document.createElement("span");q.classList.add("chart-month-with-info","tooltipped","tooltipped-ne"),q.setAttribute("aria-label",m.text),q.append(u.cloneNode(!0)),q.append(document.createTextNode(` ${m.name}`)),i.append(q)}else i.textContent=m.name;if(E.appendChild(i),i=document.createElement("td"),i.dataset.sort=m.max.toString(),i.textContent=m.max.toLocaleString("en-US"),E.appendChild(i),A>0){const q=m.max-A,R=q/A*100;i=document.createElement("td"),i.dataset.sort=q.toString(),i.textContent=(q>0?"+":"")+q.toLocaleString("en-US"),i.className="price-discount"+(q>0?"":"-minor"),E.appendChild(i),i=document.createElement("td"),i.dataset.sort=Math.round(R).toString(),R>=1e6?i.textContent="\u221E":i.textContent=(R>=0?"+":"")+R.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})+"%",i.className="price-discount"+(q>0?"":"-minor"),E.appendChild(i)}else i=document.createElement("td"),i.textContent="-",E.appendChild(i),i=document.createElement("td"),i.textContent="-",E.appendChild(i);if(i=document.createElement("td"),i.dataset.sort=m.avg.toString(),i.classList.add("table-prices-converted"),i.textContent=m.avg>0?m.avg.toLocaleString("en-US"):"-",E.appendChild(i),S>0){const q=m.avg-S,R=q/S*100;i=document.createElement("td"),i.dataset.sort=Math.round(R).toString(),R>=1e6?i.textContent="\u221E":i.textContent=(R>=0?"+":"")+R.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})+"%",i.className="table-prices-converted price-discount"+(q>0?"":"-minor"),E.appendChild(i)}else i=document.createElement("td"),i.classList.add("table-prices-converted"),i.textContent="-",E.appendChild(i);D===753&&(i=document.createElement("td"),i.dataset.sort=m.max_twitch.toString(),i.textContent=m.max_twitch>0?m.max_twitch.toLocaleString("en-US"):"-",E.appendChild(i)),A=m.max,S=m.avg}l.querySelector("tbody").append($),new window.Tablesort(l),l.hidden=!1,y.hidden=!0}})();
